import numpy as np
from scipy.integrate import simps
import matplotlib.pyplot as plt
import time

data = np.loadtxt("cloud.dat")
x = data[:,0]
y = data[:,1]
z = data[:,2]
rho = data[:,3]

xmin = np.amin(x)
xmax = np.amax(x)
ymin = np.amin(y)
ymax = np.amax(y)
zmin = np.amin(z)
zmax = np.amax(z)

x_uniq = np.unique(x)
y_uniq = np.unique(y)
z_uniq = np.unique(z)

Nx = len(x_uniq)
Ny = len(y_uniq)
Nz = len(z_uniq)

colden = np.zeros(shape=(Nx,Ny))

start = time.time()
for i in range(0,Nx):
    for j in range(0,Ny):
        idx = i*Nz*Ny + j*Nz
        colden[i][j] = simps(rho[idx:idx+Nz],x=z[idx:idx+Nz])
print(time.time()-start)
    
plt.imshow(np.log10(colden),extent=(xmin,xmax,ymin,ymax))
plt.show()
